{% extends 'base.html' %}

{% block title %}{{ 'Editar' if pessoa else 'Cadastro' }}{% endblock %}

{% block content %}
<p class="text-muted">Usuário logado: <strong>{{ usuario }}</strong></p>

<form method="POST" action="" class="needs-validation" novalidate>
    
<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">{{ 'Editar Cadastro' if pessoa else 'Novo Cadastro' }}</h4>
    {% if pessoa %}
        <span class="badge bg-secondary">Matrícula: {{ pessoa.matricula }}</span>
    {% else %}
        <span class="badge bg-info text-dark">Matrícula: será gerada automaticamente</span>
    {% endif %}
</div>

<!-- DADOS PESSOAIS -->
<div class="card mb-4 border-primary">
    <div class="card-header bg-primary text-white">Dados Pessoais</div>
    <div class="card-body bg-light">
        <div class="mb-3">
            <label class="form-label">Nome</label>
            <input type="text" name="nome" class="form-control" required value="{{ pessoa.nome if pessoa else '' }}">
            <div class="invalid-feedback">Por favor, informe o nome.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">CPF</label>
            <input type="text" name="cpf" id="cpf" class="form-control" required value="{{ pessoa.cpf if pessoa else '' }}">
            <div class="invalid-feedback">Por favor, informe o CPF.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">Data de Nascimento</label>
            <input type="date" name="nascimento" class="form-control" required value="{{ pessoa.nascimento if pessoa else '' }}">
            <div class="invalid-feedback">Por favor, informe a data de nascimento.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">Sexo</label>
            <select name="sexo" class="form-select" required>
                <option value="" disabled selected>Selecione</option>
                <option value="Masculino" {{ 'selected' if pessoa and pessoa.sexo == 'Masculino' else '' }}>Masculino</option>
                <option value="Feminino" {{ 'selected' if pessoa and pessoa.sexo == 'Feminino' else '' }}>Feminino</option>
            </select>
            <div class="invalid-feedback">Por favor, selecione o sexo.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control" required value="{{ pessoa.email if pessoa else '' }}">
            <div class="invalid-feedback">Por favor, informe um email válido.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">Telefone</label>
            <input type="text" name="telefone" id="telefone" class="form-control" required value="{{ pessoa.telefone if pessoa else '' }}">
            <div class="invalid-feedback">Por favor, informe o telefone.</div>
        </div>
    </div>
</div>

<!-- ESCOLARIDADE, CURSOS, PROFISSÃO, MATRÍCULA E ENDEREÇO -->
<!-- [sem alterações, mantido conforme seu código original] -->
{{ super() }}

<!-- SCRIPT DE VALIDAÇÃO E MÁSCARAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.8/inputmask.min.js"></script>
<script>
    (function () {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();

    // Máscaras
    window.addEventListener('DOMContentLoaded', function () {
        Inputmask("999.999.999-99").mask(document.getElementById('cpf'));
        Inputmask({"mask": "(99) 99999-9999"}).mask(document.getElementById('telefone'));
        Inputmask("99999-999").mask(document.querySelector('input[name="cep"]'));
    });

    function mostrarOutroCampo() {
        const select = document.getElementById('profissaoSelect');
        const outroDiv = document.getElementById('outraProfissaoDiv');
        const outroInput = document.querySelector('input[name="profissao_outro"]');

        if (select.value === 'Outro') {
            outroDiv.style.display = 'block';
        } else {
            outroDiv.style.display = 'none';
            outroInput.value = '';
        }
    }
</script>
{% endblock %}

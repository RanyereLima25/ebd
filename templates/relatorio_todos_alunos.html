{% extends 'base.html' %}

{% block title %}Relatório{% endblock %}

{% block content %}
<h2 class="mb-4">Relatório: 
  {% if filtro_tipo == 'professor' %}
    Professores
  {% elif filtro_tipo == 'aluno' %}
    Alunos
  {% else %}
    Alunos e Professores
  {% endif %}
</h2>

<form method="get" class="mb-3">
  <label for="tipo">Filtrar por:</label>
  <select name="tipo" id="tipo" onchange="this.form.submit()" class="form-select w-auto d-inline mx-2">
    <option value="" {% if not filtro_tipo %}selected{% endif %}>Todos</option>
    <option value="aluno" {% if filtro_tipo == 'aluno' %}selected{% endif %}>Alunos</option>
    <option value="professor" {% if filtro_tipo == 'professor' %}selected{% endif %}>Professores</option>
  </select>
</form>

{% set pessoas_filtradas = alunos %}
{% if filtro_tipo %}
  {% set pessoas_filtradas = alunos | selectattr("tipo", "equalto", filtro_tipo) | list %}
{% endif %}

<p><strong>Total de 
  {% if filtro_tipo == 'aluno' %}alunos
  {% elif filtro_tipo == 'professor' %}professores
  {% else %}pessoas
  {% endif %}:</strong> {{ pessoas_filtradas|length }}
</p>
<hr>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Nome</th>
      <th>Data de Nascimento</th>
    </tr>
  </thead>
  <tbody>
    {% for pessoa in pessoas_filtradas %}
    <tr>
      <td>{{ pessoa.nome }}</td>
      <td>
        {% if pessoa.nascimento %}
          {{ pessoa.nascimento[8:10] }}/{{ pessoa.nascimento[5:7] }}/{{ pessoa.nascimento[0:4] }}
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('relatorios') }}" class="btn btn-secondary mt-3">Voltar</a>

<footer style="
    background-color: #f8f9fa;
    padding: 1.5rem 1rem;
    text-align: center;
    font-family: 'Georgia', serif;
    color: #444;
    border-top: 1px solid #ddd;
    margin-top: 3rem;
    ">
  <p style="font-size: 1rem; font-style: italic; max-width: 600px; margin: 0 auto 0.5rem;">
    “Dai graças em todas as circunstâncias, pois esta é a vontade de Deus para vocês em Cristo Jesus.”
  </p>
  <p style="font-weight: bold; font-size: 0.9rem; color: #2c3e50; margin-bottom: 1rem;">
    — 1 Tessalonicenses 5:18
  </p>
  <p style="font-size: 0.85rem; color: #999; letter-spacing: 1px; margin-top: 1rem;">
    <span style="font-weight: 700; color: #1a1a1a;">Registrado:</span> Ranyere Lima
  </p>
</footer>
{% endblock %}
